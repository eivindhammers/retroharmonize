<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="retroharmonize">
<title>Working With A Crosswalk Table • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Working With A Crosswalk Table">
<meta property="og:description" content="retroharmonize">
<meta property="og:image" content="https://ropengov.github.io/retroharmonize/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rOpenGov">
<meta name="twitter:site" content="@rOpenGov">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/afrobarometer.html">Case Study: Working With Afrobarometer surveys</a>
    <a class="dropdown-item" href="../articles/arabbarometer.html">Case Study: Working With Arab Barometer Surveys</a>
    <a class="dropdown-item" href="../articles/crosswalk.html">Working With A Crosswalk Table</a>
    <a class="dropdown-item" href="../articles/eurobarometer.html">Case Study: Working with Eurobarometer surveys</a>
    <a class="dropdown-item" href="../articles/harmonize_labels.html">Harmonize Value Labels</a>
    <a class="dropdown-item" href="../articles/labelled_spss_survey.html">The labelled_spss_survey class</a>
    <a class="dropdown-item" href="../articles/metadata.html">Working With Survey Metadata</a>
    <a class="dropdown-item" href="../articles/survey_harmonization.html">Survey Harmonization</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="crosswalk_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Working With A Crosswalk Table</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/HEAD/vignettes/crosswalk.Rmd" class="external-link"><code>vignettes/crosswalk.Rmd</code></a></small>
      <div class="d-none name"><code>crosswalk.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span></code></pre></div>
<p>Let’s read in the package’s small examples, and create a metadata table from them. These steps were explained in the vignette <a href="https://retroharmonize.dataobservatory.eu/articles/metadata.html" class="external-link">Working With Survey Metadata</a>.</p>
<p>From a technical perspecitve, the aim of the survey harmonization is to create a single, tidy, joined table in the form of a data frame that contains a row identifier, which is truly unique across all observations and the concatenated and harmonized variables.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">examples_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"examples"</span>, package <span class="op">=</span> <span class="st">"retroharmonize"</span><span class="op">)</span>
<span class="va">survey_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"\\.rds"</span>, <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span><span class="op">(</span><span class="va">examples_dir</span><span class="op">)</span><span class="op">)</span><span class="op">]</span>
<span class="va">survey_files</span>
<span class="co">#&gt; [1] "ZA5913.rds" "ZA6863.rds" "ZA7576.rds"</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">survey_paths</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">examples_dir</span>, <span class="va">survey_files</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_surveys_create</a></span> <span class="op">(</span>survey_files <span class="op">=</span> <span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span>
<span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA5913.rds</span>
<span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA6863.rds</span>
<span class="co">#&gt; Read: /home/runner/work/_temp/Library/retroharmonize/examples/ZA7576.rds</span></code></pre></div>
<div class="section level2">
<h2 id="crosswalk-table">Crosswalk Table<a class="anchor" aria-label="anchor" href="#crosswalk-table"></a>
</h2>
<p>A schema crosswalk, or a crosswalk table is a table that shows equivalent elements (or “fields”) in more than one survey. In this example, we will create a crosswalk table of a subset of the tree example surveys. We will use three variables: the unique row identifier, the Trust in the European Parliament concept, and the country code.</p>
<p>By filtering out the other variables, we have the basic information in our metadata table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'dplyr'</span>
<span class="co">#&gt; The following objects are masked from 'package:stats':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     filter, lag</span>
<span class="co">#&gt; The following objects are masked from 'package:base':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     intersect, setdiff, setequal, union</span>
<span class="va">subset_example_metadata</span> <span class="op">&lt;-</span> <span class="va">example_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^unique_identifier_in|trust|country_code"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^unique_identifier_in|european_parliament|country_code"</span>, 
                 <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">var_name_orig</span> <span class="op">!=</span> <span class="st">"uniqid"</span><span class="op">)</span> 

<span class="va">subset_example_metadata</span>
<span class="co">#&gt;     filename     id var_name_orig          class_orig</span>
<span class="co">#&gt; 1 ZA5913.rds ZA5913         rowid           character</span>
<span class="co">#&gt; 2 ZA5913.rds ZA5913      isocntry           character</span>
<span class="co">#&gt; 3 ZA5913.rds ZA5913        qa10_1 haven_labelled_spss</span>
<span class="co">#&gt; 4 ZA6863.rds ZA6863         rowid           character</span>
<span class="co">#&gt; 5 ZA6863.rds ZA6863      isocntry           character</span>
<span class="co">#&gt; 6 ZA6863.rds ZA6863        qa14_1      haven_labelled</span>
<span class="co">#&gt; 7 ZA7576.rds ZA7576         rowid           character</span>
<span class="co">#&gt; 8 ZA7576.rds ZA7576      isocntry           character</span>
<span class="co">#&gt; 9 ZA7576.rds ZA7576        qa14_1 haven_labelled_spss</span>
<span class="co">#&gt;                 var_label_orig     labels valid_labels na_labels na_range</span>
<span class="co">#&gt; 1 unique_identifier_in_za_5913         NA           NA        NA       NA</span>
<span class="co">#&gt; 2        country_code_iso_3166         NA           NA        NA       NA</span>
<span class="co">#&gt; 3    european_parliament_trust    1, 2, 3         1, 2         3       NA</span>
<span class="co">#&gt; 4 unique_identifier_in_za_6863         NA           NA        NA       NA</span>
<span class="co">#&gt; 5        country_code_iso_3166         NA           NA        NA       NA</span>
<span class="co">#&gt; 6    european_parliament_trust    1, 2, 3      1, 2, 3                 NA</span>
<span class="co">#&gt; 7 unique_identifier_in_za_7576         NA           NA        NA       NA</span>
<span class="co">#&gt; 8        country_code_iso_3166         NA           NA        NA       NA</span>
<span class="co">#&gt; 9    european_parliament_trust 1, 2, 3, 9      1, 2, 3         9       NA</span>
<span class="co">#&gt;   n_labels n_valid_labels n_na_labels</span>
<span class="co">#&gt; 1        0              0           0</span>
<span class="co">#&gt; 2        0              0           0</span>
<span class="co">#&gt; 3        3              2           1</span>
<span class="co">#&gt; 4        0              0           0</span>
<span class="co">#&gt; 5        0              0           0</span>
<span class="co">#&gt; 6        3              3           0</span>
<span class="co">#&gt; 7        0              0           0</span>
<span class="co">#&gt; 8        0              0           0</span>
<span class="co">#&gt; 9        4              3           1</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crosswalk_table_create.html">crosswalk_table_create</a></span><span class="op">(</span><span class="va">subset_example_metadata</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target", "na_label_orig", "na_label_target", "na_numeric_orig", "na_numeric_target", "var_label_orig", "var_label_target", "class_orig", "class_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target")</span>
<span class="co">#&gt; Joining, by = c("id", "filename", "var_name_orig", "var_name_target", "val_numeric_orig", "val_numeric_target", "val_label_orig", "val_label_target", "na_label_orig", "na_label_target", "na_numeric_orig", "na_numeric_target", "var_label_orig", "var_label_target", "class_orig", "class_target")</span>
<span class="va">ct</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 16</span></span>
<span class="co">#&gt;    id     filename   var_name_orig var_name_target val_numeric_orig</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913 ZA5913.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913 ZA5913.rds isocntry      isocntry                      <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913 ZA5913.rds qa10_1        qa10_1                         1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913 ZA5913.rds qa10_1        qa10_1                         2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA5913 ZA5913.rds qa10_1        qa10_1                         3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863 ZA6863.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863 ZA6863.rds isocntry      isocntry                      <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863 ZA6863.rds qa14_1        qa14_1                         1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA6863 ZA6863.rds qa14_1        qa14_1                         2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA6863 ZA6863.rds qa14_1        qa14_1                         3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576 ZA7576.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576 ZA7576.rds isocntry      isocntry                      <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> ZA7576 ZA7576.rds qa14_1        qa14_1                         9</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 11 more variables: val_numeric_target &lt;dbl&gt;, val_label_orig &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   val_label_target &lt;chr&gt;, na_label_orig &lt;chr&gt;, na_label_target &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   na_numeric_orig &lt;dbl&gt;, na_numeric_target &lt;dbl&gt;, var_label_orig &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   var_label_target &lt;chr&gt;, class_orig &lt;chr&gt;, class_target &lt;chr&gt;</span></span></code></pre></div>
<p>The harmonization of the variable names requires a single, unambiguous name for the variables that represent the same concept:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span>, 
    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"isocntry"</span> <span class="op">~</span>  <span class="st">"geo"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"trust_ep"</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"var_name_orig"</span>, <span class="st">"var_name_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 3</span></span>
<span class="co">#&gt;   filename   var_name_orig var_name_target</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913.rds rowid         rowid          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913.rds isocntry      geo            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913.rds qa10_1        trust_ep       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA6863.rds rowid         rowid          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA6863.rds isocntry      geo            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA6863.rds qa14_1        trust_ep       </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span> ZA7576.rds rowid         rowid          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">8</span> ZA7576.rds isocntry      geo            </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">9</span> ZA7576.rds qa14_1        trust_ep</span></code></pre></div>
<p>The table should contain instruction on harmonizing the numeric value codes and value labels. We create an unambigous coding, and to be on the safe side, the special missing value is placed far away from the normal values.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">val_numeric_orig</span>, 
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">99999</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"trust"</span>, 
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"distrust"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"declined"</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, 
                             <span class="st">"val_numeric_orig"</span>, <span class="st">"val_numeric_target"</span>, 
                             <span class="st">"val_label_orig"</span>,  <span class="st">"val_label_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
             <span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 5</span></span>
<span class="co">#&gt;    filename   val_numeric_orig val_numeric_targ… val_label_orig val_label_target</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913.rds               <span style="color: #BB0000;">NA</span>             <span style="text-decoration: underline;">99</span>999 <span style="color: #BB0000;">NA</span>             declined        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913.rds                1                 1 Tend to trust  trust           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913.rds                2                 0 Tend not to t… distrust        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913.rds                3             <span style="text-decoration: underline;">99</span>999 DK             declined        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA6863.rds               <span style="color: #BB0000;">NA</span>             <span style="text-decoration: underline;">99</span>999 <span style="color: #BB0000;">NA</span>             declined        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863.rds                1                 1 Tend to trust  trust           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863.rds                2                 0 Tend not to t… distrust        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863.rds                3             <span style="text-decoration: underline;">99</span>999 DK             declined        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA7576.rds               <span style="color: #BB0000;">NA</span>             <span style="text-decoration: underline;">99</span>999 <span style="color: #BB0000;">NA</span>             declined        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA7576.rds                1                 1 Tend to trust  trust           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576.rds                2                 0 Tend not to t… distrust        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576.rds                3             <span style="text-decoration: underline;">99</span>999 DK             declined        </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576.rds                9             <span style="text-decoration: underline;">99</span>999 Inap. (not CY… declined</span></code></pre></div>
<p>And now let’s turn our attention to the special (missing) cases. Sometimes there may be other special cases in the code range, but the most likely suspects are values that represent some form of missing answers to a question or a missing questionnaire item selection.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">na_numeric_orig</span> <span class="op">==</span>  <span class="fl">3</span> <span class="op">~</span> <span class="fl">99999</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">na_numeric_target</span> <span class="op">==</span> <span class="fl">99999</span> <span class="op">~</span> <span class="st">"declined"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct.html" class="external-link">distinct</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"val_numeric_orig"</span>,  
                             <span class="st">"na_numeric_orig"</span>, <span class="st">"na_numeric_target"</span>,
                             <span class="st">"na_label_orig"</span>,  <span class="st">"na_label_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
             <span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 13 × 6</span></span>
<span class="co">#&gt;    filename   val_numeric_orig na_label_orig     na_label_target na_numeric_orig</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                 <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                     <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913.rds               <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913.rds                1 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913.rds                2 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913.rds                3 DK                declined                      3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA6863.rds               <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863.rds                1 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863.rds                2 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863.rds                3 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA7576.rds               <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA7576.rds                1 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576.rds                2 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576.rds                3 <span style="color: #BB0000;">NA</span>                <span style="color: #BB0000;">NA</span>                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576.rds                9 Inap. (not CY-TC… <span style="color: #BB0000;">NA</span>                            9</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 1 more variable: na_numeric_target &lt;dbl&gt;</span></span></code></pre></div>
<p>Putting the entire process in one pipeline:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_crosswalk_table</span> <span class="op">&lt;-</span> <span class="va">ct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span>, 
    <span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"isocntry"</span> <span class="op">~</span>  <span class="st">"geo"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"trust_ep"</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">val_numeric_orig</span>, 
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="fl">0</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="fl">99999</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">1</span> <span class="op">~</span> <span class="st">"trust"</span>, 
    <span class="va">val_numeric_orig</span> <span class="op">==</span> <span class="fl">2</span> <span class="op">~</span> <span class="st">"distrust"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"declined"</span>
  <span class="op">)</span><span class="op">)</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">na_numeric_orig</span> <span class="op">==</span>  <span class="fl">3</span> <span class="op">~</span> <span class="fl">99999</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">na_numeric_target</span> <span class="op">==</span> <span class="fl">99999</span> <span class="op">~</span> <span class="st">"declined"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_character_</span>
  <span class="op">)</span><span class="op">)</span>

<span class="va">example_crosswalk_table</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 16</span></span>
<span class="co">#&gt;    id     filename   var_name_orig var_name_target val_numeric_orig</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> ZA5913 ZA5913.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> ZA5913 ZA5913.rds isocntry      geo                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> ZA5913 ZA5913.rds qa10_1        trust_ep                       1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> ZA5913 ZA5913.rds qa10_1        trust_ep                       2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> ZA5913 ZA5913.rds qa10_1        trust_ep                       3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> ZA6863 ZA6863.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> ZA6863 ZA6863.rds isocntry      geo                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> ZA6863 ZA6863.rds qa14_1        trust_ep                       1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> ZA6863 ZA6863.rds qa14_1        trust_ep                       2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> ZA6863 ZA6863.rds qa14_1        trust_ep                       3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> ZA7576 ZA7576.rds rowid         rowid                         <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> ZA7576 ZA7576.rds isocntry      geo                           <span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       1</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       2</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       3</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> ZA7576 ZA7576.rds qa14_1        trust_ep                       9</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 11 more variables: val_numeric_target &lt;dbl&gt;, val_label_orig &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   val_label_target &lt;chr&gt;, na_label_orig &lt;chr&gt;, na_label_target &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   na_numeric_orig &lt;dbl&gt;, na_numeric_target &lt;dbl&gt;, var_label_orig &lt;chr&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   var_label_target &lt;chr&gt;, class_orig &lt;chr&gt;, class_target &lt;chr&gt;</span></span></code></pre></div>
<p>Reading the crosswalk table is very simple:</p>
<ul>
<li>In <code>ZA6863.rds</code> rename the questionnaire item <code>qa14_1</code> stored as a variable to <code>trust_ep</code>.<br>
</li>
<li>Recode the numeric values from <code>2</code> to <code>0</code> and label them to <code>distrust</code>.</li>
<li>Recode the special values from <code>3</code> to <code>99999</code> and label them <code>declined</code>.</li>
</ul>
</div>
<div class="section level2">
<h2 id="subsetting">Subsetting<a class="anchor" aria-label="anchor" href="#subsetting"></a>
</h2>
<p>From a technical perspecitve, the aim of the survey harmonization is to create a single, tidy, joined table. For making joining possible (and to reduce memory use), a first processing step is to remove irrelevant variables that will not be harmonized.</p>
<p>There are several ways how the subsetting can be made. With smaller tasks all the surveys can be stored in memory and the subsequent processing made fast in memory. With many surveys, we provide a slower but memory-saving way of importing and subsetting consequtive surveys from files.</p>
<p>Recall from the vignette <a href="https://retroharmonize.dataobservatory.eu/articles/metadata.html" class="external-link">Working With Survey Metadata</a> that you can read files into a list of surveys:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">example_surveys</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span> <span class="op">(</span><span class="va">survey_paths</span>, .f <span class="op">=</span> <span class="st">"read_rds"</span><span class="op">)</span></code></pre></div>
<p>Now let’s focus of our attention to a small subset of the variables.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subset_survey_list_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_surveys.html">subset_surveys</a></span><span class="op">(</span>survey_list <span class="op">=</span> <span class="va">example_surveys</span>, 
                                       subset_vars <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowid"</span>, <span class="st">"isocntry"</span>, <span class="st">"qa10_1"</span>, <span class="st">"qa14_1"</span><span class="op">)</span>, 
                                       subset_name <span class="op">=</span> <span class="st">"subset_example"</span><span class="op">)</span></code></pre></div>
<p>We still have the three surveys in a list:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">subset_survey_list_1</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"id"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] "ZA5913" "ZA6863" "ZA7576"</span></code></pre></div>
<p>The top few rows of the first subsetted survey to see if the subsetting took place:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subset_survey_list_1</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   rowid    isocntry                qa10_1</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913_1 NL       2<span style="color: #949494;"> [Tend not to trust]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913_2 NL       2<span style="color: #949494;"> [Tend not to trust]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913_3 NL       3<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [DK]</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA5913_4 NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA5913_5 NL       1<span style="color: #949494;"> [Tend to trust]</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA5913_6 NL       1<span style="color: #949494;"> [Tend to trust]</span></span></code></pre></div>
<p>The names are identical to the original names:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span> <span class="op">(</span><span class="va">subset_survey_list_1</span>, <span class="va">names</span><span class="op">)</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "rowid"    "isocntry" "qa10_1"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "rowid"    "isocntry" "qa14_1"  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "rowid"    "isocntry" "qa14_1"</span></code></pre></div>
<p>This is not a very practical, because we cannot join these tables into a single, harmonized dataset. The first step is to harmonize the names of those variables that represent the same concept, in this case, <em>Trust in the European Parliament</em>. The next steps, i.e. the harmonization of the numerical codes of answers and their labels will be discussed in the <a href="https://retroharmonize.dataobservatory.eu/articles/harmonize_labels.html" class="external-link">Harmonize Value Labels</a> vignette.</p>
</div>
<div class="section level2">
<h2 id="variable-name-harmonization">Variable Name Harmonization<a class="anchor" aria-label="anchor" href="#variable-name-harmonization"></a>
</h2>
<p>It is very practical to do the subsetting and the variable name harmonization in one step. The <code><a href="../reference/subset_surveys.html">subset_save_surveys()</a></code> function will do this optionally, and a wrapper function <code>harmonize_surveys()</code> will validate that all metadata (i.e. the original, source variable names and the new, target variable names) are present.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">subset_survey_list_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/subset_surveys.html">subset_surveys</a></span><span class="op">(</span>crosswalk_table <span class="op">=</span> <span class="va">example_crosswalk_table</span>, 
                                       survey_list <span class="op">=</span> <span class="va">example_surveys</span>,
                                       subset_name <span class="op">=</span> <span class="st">"trust_ep"</span><span class="op">)</span></code></pre></div>
<p>We have again the three surveys in a list:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">vapply</a></span><span class="op">(</span><span class="va">subset_survey_list_2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"id"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   ZA5913   ZA6863   ZA7576 </span>
<span class="co">#&gt; "ZA5913" "ZA6863" "ZA7576"</span></code></pre></div>
<p>The top few rows of the first subsetted survey now show that we have new, harmonized names.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">subset_survey_list_2</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   rowid    geo                trust_ep</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913_1 NL    2<span style="color: #949494;"> [Tend not to trust]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913_2 NL    2<span style="color: #949494;"> [Tend not to trust]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913_3 NL    3<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [DK]</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA5913_4 NL    1<span style="color: #949494;"> [Tend to trust]</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA5913_5 NL    1<span style="color: #949494;"> [Tend to trust]</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA5913_6 NL    1<span style="color: #949494;"> [Tend to trust]</span></span></code></pre></div>
<p>Our variable names are harmonized:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span> <span class="op">(</span><span class="va">subset_survey_list_2</span>, <span class="va">names</span><span class="op">)</span>
<span class="co">#&gt; $ZA5913</span>
<span class="co">#&gt; [1] "rowid"    "geo"      "trust_ep"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ZA6863</span>
<span class="co">#&gt; [1] "rowid"    "geo"      "trust_ep"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $ZA7576</span>
<span class="co">#&gt; [1] "rowid"    "geo"      "trust_ep"</span></code></pre></div>
<p>While this example easily fits in the memory, when working with several dozens of SPSS files, it is better to sequentially import the surveys from file, and save the output to files. By default, the parameters <code>import_path</code> and <code>export_path</code> are set to <code>NULL</code>. If you enter a valid path to a directory, the function will look for the files specified in the <code>crosswalk_table$filename</code> on this path.</p>
<ul>
<li>If you do not specify the <code>export_path</code>, a list of surveys will be returned.</li>
<li>If you specify the <code>export_path</code>, a vector of the saved file names (with full path) will be returned.</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/subset_surveys.html">subset_save_surveys</a></span><span class="op">(</span>crosswalk_table <span class="op">=</span> <span class="va">example_crosswalk_table</span>, 
                    subset_name <span class="op">=</span> <span class="st">"trust_ep"</span>,
                    import_path <span class="op">=</span> <span class="va">examples_dir</span>, 
                    export_path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Saving ZA5913_trust_ep.rds</span>
<span class="co">#&gt; Saving ZA6863_trust_ep.rds</span>
<span class="co">#&gt; Saving ZA7576_trust_ep.rds</span>
<span class="co">#&gt; [1] "/tmp/RtmpcHiAd8/ZA5913_trust_ep.rds" "/tmp/RtmpcHiAd8/ZA6863_trust_ep.rds"</span>
<span class="co">#&gt; [3] "/tmp/RtmpcHiAd8/ZA7576_trust_ep.rds"</span></code></pre></div>
<p>The subsetted surveys are saved with a common name element, <code>trust_ep</code> to the export file location, in this case a temporary directory created with <code><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir()</a></code>.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">readRDS</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"ZA5913_trust_ep.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span>
<span class="co">#&gt;   rowid    geo                trust_ep</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;dbl+lbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> ZA5913_1 NL    2<span style="color: #949494;"> [Tend not to trust]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> ZA5913_2 NL    2<span style="color: #949494;"> [Tend not to trust]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> ZA5913_3 NL    3<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [DK]</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> ZA5913_4 NL    1<span style="color: #949494;"> [Tend to trust]</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> ZA5913_5 NL    1<span style="color: #949494;"> [Tend to trust]</span>    </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> ZA5913_6 NL    1<span style="color: #949494;"> [Tend to trust]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="further-steps">Further Steps<a class="anchor" aria-label="anchor" href="#further-steps"></a>
</h2>
<p>Having a subsetted list of surveys with harmonized variable names is usually not yet an output that is ready for statistical analysis. In the next step, the numerical codes, the variable labels need to be made consistent, with a special attention given to special values, particularly to missing values.</p>
<p>At last, if the statistical analysis will take place in R, a converstion to basic R classes is necessary to rely on the vast arsenal of R’s statistical packages. This means that the survey data must be brought to a consistent numeric or a consistent factor format (and in some cases, for visualization, to a character format).</p>
<p>We created a special s3 class (see <code><a href="../reference/labelled_spss_survey.html">?labelled_spss_survey</a></code>), which retains the metadata about coding and special values, and created three methods that take into consideration the retained metadata. For example, if 999 is the code for declined answers, then the base are <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric()</a></code> will coerce observations (survey responses) with a value <code>999</code> to a numerical value of <code>999</code>, but the <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code> method will give a <code>NA_real_</code> representation to this observation. Averaging numerical, coded values will give a logically wrong result with the basic as.numeric, but a correct with the <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code> method.</p>
<p>The crosswalk table is a map for value code and label harmonization, and for type conversion, too. This is the topic of the <a href="https://retroharmonize.dataobservatory.eu/articles/harmonize_labels.html" class="external-link">Harmonize Value Labels</a> vignette.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.0.</p>
</div>

    </footer>
</div>

  

    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
