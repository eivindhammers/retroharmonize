<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="retroharmonize">
<title>Case Study: Working With Afrobarometer surveys • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Case Study: Working With Afrobarometer surveys">
<meta property="og:description" content="retroharmonize">
<meta property="og:image" content="https://ropengov.github.io/retroharmonize/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rOpenGov">
<meta name="twitter:site" content="@rOpenGov">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="afrobarometer_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Case Study: Working With Afrobarometer surveys</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/HEAD/vignettes/afrobarometer.Rmd" class="external-link"><code>vignettes/afrobarometer.Rmd</code></a></small>
      <div class="d-none name"><code>afrobarometer.Rmd</code></div>
    </div>

    
    
<p>The goal of this case study is to explore the variation in trust in various state institutions among African societies, as well as changes in trust over time.</p>
<p>To do this, we use data from <a href="https://afrobarometer.org/data/" class="external-link">Afrobarometer</a>, a cross-national survey project measuring attitudes and opinions about democracy, the economy and society in African countries based on general population samples. Currently, seven rounds of the Afrobarometer are available, covering the period between 1999 and 2019.</p>
<p><code>retroharmonize</code> is not affiliated with Afrobarometer. To fully reproduce this example, you must acquire the data files from them, which is free of charge. Afrobarometer data is protected by copyright. Authors of any published work based on Afrobarometer data or papers are required to acknowledge the source, including, where applicable, citations to data sets posted on this website. Please acknowledge the copyright holders in all publications resulting from its use by means of bibliographic citation in this form:</p>
<p>In this vignette, we harmonize data from rounds <a href="https://afrobarometer.org/data/merged-round-5-data-34-countries-2011-2013-last-update-july-2015" class="external-link">Afrobarometer Data Round 5 (all countries)</a>, <a href="https://afrobarometer.org/data/merged-round-6-data-36-countries-2016" class="external-link">Afrobarometer Data Round 6 (all countries)</a> and <a href="https://afrobarometer.org/data/merged-round-7-data-34-countries-2019" class="external-link">Afrobarometer Data Round 7 (all countries)</a>. Some elements of the vignette are not “live”, because we want to avoid re-publishing the original microdata files from Afrobarometer, but you can access the data directly from the <a href="https://afrobarometer.org/" class="external-link">www.afrobarometer.org website</a>.</p>
<p>File names (to identify file versions):<br>
Round 5: <code>merged-round-5-data-34-countries-2011-2013-last-update-july-2015.sav</code><br>
Round 6: <code>merged_r6_data_2016_36countries2.sav</code><br>
Round 7: <code>r7_merged_data_34ctry.release.sav</code></p>
<p>For reproducibility, we are storing only a small subsample from the files and the metadata. We assume that you extracted and copied all <code>.sav</code> files into a single folder that we will call in this vignette the <code>afrobarometer_dir</code>. Define your <code>afrobarometer_dir</code> with <code><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path()</a></code> in your own system.</p>
<div class="section level2">
<h2 id="importing-afrobarometer-files">Importing Afrobarometer Files<a class="anchor" aria-label="anchor" href="#importing-afrobarometer-files"></a>
</h2>
<p>We start by reading in the three rounds of the Afrobarometer.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">### use here your own directory</span>
<span class="va">ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">dir</a></span> <span class="op">(</span> <span class="va">afrobarometer_dir</span>, pattern <span class="op">=</span> <span class="st">"sav$"</span> <span class="op">)</span>
<span class="va">afrobarometer_rounds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">afrobarometer_dir</span>, <span class="va">ab</span><span class="op">)</span>

<span class="va">ab_waves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_surveys.html">read_surveys</a></span><span class="op">(</span><span class="va">afrobarometer_rounds</span>, .f<span class="op">=</span><span class="st">'read_spss'</span><span class="op">)</span></code></pre></div>
<p>Let’s give a bit more meaningful identifiers than the file names:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ab_waves</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, <span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Afrobarometer_R5"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ab_waves</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span>, <span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Afrobarometer_R6"</span>
<span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">ab_waves</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span>, <span class="st">"id"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Afrobarometer_R7"</span></code></pre></div>
<p>We can review if the main descriptive metadata is correctly present with <code><a href="../reference/document_surveys.html">document_surveys()</a></code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">documented_ab_waves</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/document_surveys.html">document_surveys</a></span><span class="op">(</span><span class="va">ab_waves</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">documented_ab_waves</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span>
<span class="co">#&gt;   id               filename                               ncol  nrow object_size</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Afrobarometer_R5 merged-round-5-data-34-countries-201…   349 <span style="text-decoration: underline;">51</span>587   159<span style="text-decoration: underline;">027</span>592</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Afrobarometer_R6 merged_r6_data_2016_36countries2.sav    365 <span style="text-decoration: underline;">53</span>935   172<span style="text-decoration: underline;">064</span>576</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Afrobarometer_R7 r7_merged_data_34ctry.release.sav       367 <span style="text-decoration: underline;">45</span>823   148<span style="text-decoration: underline;">759</span>488</span></code></pre></div>
<p>Create a metadata table, or a data map, that contains information about the variable names and labels, and where each row correspnds to one variable in the survey data file. We do this with the function <code><a href="../reference/metadata_survey_create.html">metadata_survey_create()</a></code>, which extracts the metadata from the survery data files, normalizes variable labels, identifies ranges of substantive responses and missing value codes. Its wrapper, <code><a href="../reference/metadata_create.html">metadata_create()</a></code>, loops the function on a list of surveys, or on a set of files containing surveys.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">ab_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span> <span class="op">(</span> survey_list <span class="op">=</span> <span class="va">ab_waves</span> <span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="working-with-metadata">Working with metadata<a class="anchor" aria-label="anchor" href="#working-with-metadata"></a>
</h2>
<p>From the metadata file we select only those rows that correspond to the variables that we’re interested in: the <code>rowid</code> being the unique case identifier, <code>DATEINTR</code> with the interview date, <code>COUNTRY</code> containing information about the country where the interview was conducted, <code>REGION</code> with the region (sub-national unit) where the interview was conducted, and <code>withinwt</code> being the weighting factor.</p>
<p>Further, we select all variables that have the word “trust” in the normalized variable label.</p>
<p>For these variables, we create normalized variable names (<code>var_name</code>) and labels (<code>var_label</code>).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span>
<span class="va">to_harmonize</span> <span class="op">&lt;-</span> <span class="va">ab_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">var_name_orig</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> 
             <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowid"</span>, <span class="st">"DATEINTR"</span>, <span class="st">"COUNTRY"</span>, <span class="st">"REGION"</span>, <span class="st">"withinwt"</span><span class="op">)</span> <span class="op">|</span>
             <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"trust "</span>, <span class="va">label_orig</span> <span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_label <span class="op">=</span> <span class="fu"><a href="../reference/label_normalize.html">var_label_normalize</a></span><span class="op">(</span><span class="va">label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_label <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^unique identifier"</span>, <span class="va">var_label</span><span class="op">)</span> <span class="op">~</span> <span class="st">"unique_id"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">var_label</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name <span class="op">=</span> <span class="fu"><a href="../reference/label_normalize.html">val_label_normalize</a></span><span class="op">(</span><span class="va">var_label</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To further reduce the size of the analysis, we only choose a few variables based on the normalized variable names (<code>var_name</code>).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">to_harmonize</span> <span class="op">&lt;-</span> <span class="va">to_harmonize</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span> <span class="op">(</span> <span class="st">"president|parliament|religious|traditional|unique_id|weight|country|date_of_int"</span>, <span class="va">var_name</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>The resulting table with information about the variables selected for harmonization looks as follows:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">to_harmonize</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
       <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"var_name"</span>, <span class="st">"var_label"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span>
<span class="co">#&gt;                  id                                             var_name</span>
<span class="co">#&gt; 1  Afrobarometer_R5                                            unique_id</span>
<span class="co">#&gt; 2  Afrobarometer_R5                                              country</span>
<span class="co">#&gt; 3  Afrobarometer_R5                                    date_of_interview</span>
<span class="co">#&gt; 4  Afrobarometer_R5 trust_key_leadership_figure_president_prime_minister</span>
<span class="co">#&gt; 5  Afrobarometer_R5                   trust_parliament_national_assembly</span>
<span class="co">#&gt; 6  Afrobarometer_R5                      within_country_weighting_factor</span>
<span class="co">#&gt; 7  Afrobarometer_R6                                            unique_id</span>
<span class="co">#&gt; 8  Afrobarometer_R6                                              country</span>
<span class="co">#&gt; 9  Afrobarometer_R6                                    date_of_interview</span>
<span class="co">#&gt; 10 Afrobarometer_R6                                      trust_president</span>
<span class="co">#&gt;                                               var_label</span>
<span class="co">#&gt; 1                                             unique_id</span>
<span class="co">#&gt; 2                                               country</span>
<span class="co">#&gt; 3                                     date of interview</span>
<span class="co">#&gt; 4  trust key leadership figure president prime minister</span>
<span class="co">#&gt; 5                    trust parliament national assembly</span>
<span class="co">#&gt; 6                       within country weighting factor</span>
<span class="co">#&gt; 7                                             unique_id</span>
<span class="co">#&gt; 8                                               country</span>
<span class="co">#&gt; 9                                     date of interview</span>
<span class="co">#&gt; 10                                      trust president</span></code></pre></div>
<p>The <code><a href="../reference/merge_surveys.html">merge_surveys()</a></code> function harmonizes the variable names, the variable labels and survey identifiers and returns a list of surveys (of class <code><a href="../reference/survey.html">survey()</a></code>.) The parameter <code>var_harmonization</code> must be a list or a data frame that contains at least the original file name (<code>filename</code>), original variable names (<code>var_name_orig</code>), the new variable names (<code>var_name</code>) and their labels (<code>var_label</code>), so that the program knows which variables to take from what files and how to call and label them after transformation.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">merged_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/merge_surveys.html">merge_surveys</a></span> <span class="op">(</span> survey_list <span class="op">=</span> <span class="va">ab_waves</span>, 
                             var_harmonization <span class="op">=</span> <span class="va">to_harmonize</span> <span class="op">)</span>

<span class="co"># country will be a character variable, and doesn't need a label</span>
<span class="va">merged_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span> <span class="op">(</span> <span class="va">merged_ab</span>, 
         FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span>  <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
           <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> country <span class="op">=</span> <span class="fu"><a href="../reference/labelled_spss_survey.html">as_character</a></span><span class="op">(</span><span class="va">country</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Review the most important metadata with <code><a href="../reference/document_surveys.html">document_surveys()</a></code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">documenteded_merged_ab</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/document_surveys.html">document_surveys</a></span><span class="op">(</span><span class="va">merged_ab</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">documenteded_merged_ab</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 5</span></span>
<span class="co">#&gt;   id               filename                               ncol  nrow object_size</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                 <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Afrobarometer_R5 merged-round-5-data-34-countries-201…     6 <span style="text-decoration: underline;">51</span>587    11<span style="text-decoration: underline;">570</span>496</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Afrobarometer_R6 merged_r6_data_2016_36countries2.sav      8 <span style="text-decoration: underline;">53</span>935     8<span style="text-decoration: underline;">652</span>392</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Afrobarometer_R7 r7_merged_data_34ctry.release.sav         8 <span style="text-decoration: underline;">45</span>823     7<span style="text-decoration: underline;">353</span>968</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="harmonization">Harmonization<a class="anchor" aria-label="anchor" href="#harmonization"></a>
</h2>
<p>In the Afrobarometer trust is measured with four-point ordinal rating scales. Such data are best analyzed with ordinal models, which do not assume that the points are equidistant. However, to get a quick idea of how the data look like, we will assign numbers 0-3, with 0 corresponding to the least trust, and 3 corresponding to the most trust, and for the time-being analyze the data as if they were metric.</p>
<p>To review the harmonization on a single survey use <code><a href="../reference/pull_survey.html">pull_survey()</a></code>. Here we select Afrobarometer Round 6.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">R6</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/pull_survey.html">pull_survey</a></span> <span class="op">(</span> <span class="va">merged_ab</span>, id <span class="op">=</span> <span class="st">"Afrobarometer_R6"</span> <span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">R6</span><span class="op">$</span><span class="va">trust_president</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">20</span><span class="op">]</span><span class="op">)</span>
<span class="co">#&gt; $labels</span>
<span class="co">#&gt;                          Missing                       Not at all </span>
<span class="co">#&gt;                               -1                                0 </span>
<span class="co">#&gt;                    Just a little                         Somewhat </span>
<span class="co">#&gt;                                1                                2 </span>
<span class="co">#&gt;                            A lot Don’t know/ Haven't heard enough </span>
<span class="co">#&gt;                                3                                9 </span>
<span class="co">#&gt;                          Refused </span>
<span class="co">#&gt;                               98 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $label</span>
<span class="co">#&gt; [1] "trust president"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Afrobarometer_R6_name</span>
<span class="co">#&gt; [1] "."</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Afrobarometer_R6_values</span>
<span class="co">#&gt; -1  0  1  2  3  9 98 </span>
<span class="co">#&gt; -1  0  1  2  3  9 98 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Afrobarometer_R6_label</span>
<span class="co">#&gt; [1] "Q52a. Trust president"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $Afrobarometer_R6_labels</span>
<span class="co">#&gt;                          Missing                       Not at all </span>
<span class="co">#&gt;                               -1                                0 </span>
<span class="co">#&gt;                    Just a little                         Somewhat </span>
<span class="co">#&gt;                                1                                2 </span>
<span class="co">#&gt;                            A lot Don’t know/ Haven't heard enough </span>
<span class="co">#&gt;                                3                                9 </span>
<span class="co">#&gt;                          Refused </span>
<span class="co">#&gt;                               98 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $id</span>
<span class="co">#&gt; [1] "Afrobarometer_R6"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"</span></code></pre></div>
<p>The <code><a href="../reference/document_survey_item.html">document_survey_item()</a></code> function shows the metadata of a single variable.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/document_survey_item.html">document_survey_item</a></span><span class="op">(</span><span class="va">R6</span><span class="op">$</span><span class="va">trust_president</span><span class="op">)</span>
<span class="co">#&gt; $code_table</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 7 × 5</span></span>
<span class="co">#&gt;   values Afrobarometer_R6_values labels           Afrobarometer_R6_labe… missing</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>            <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     -<span style="color: #BB0000;">1</span>                      -<span style="color: #BB0000;">1</span> Missing          Missing                FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      0                       0 Not at all       Not at all             FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span>      1                       1 Just a little    Just a little          FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span>      2                       2 Somewhat         Somewhat               FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span>      3                       3 A lot            A lot                  FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span>      9                       9 Don’t know/ Hav… Don’t know/ Haven't h… FALSE  </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">7</span>     98                      98 Refused          Refused                FALSE  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_var_name</span>
<span class="co">#&gt;                  name Afrobarometer_R6_name </span>
<span class="co">#&gt;  "R6$trust_president"                   "." </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_var_label</span>
<span class="co">#&gt;                   label  Afrobarometer_R6_label </span>
<span class="co">#&gt;       "trust president" "Q52a. Trust president" </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_na_range</span>
<span class="co">#&gt; character(0)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $history_id</span>
<span class="co">#&gt; [1] "Afrobarometer_R6"</span></code></pre></div>
<p>Afrobarometer’s SPSS files do not mark the missing values, so we have to be careful. The set of labels that are identified as missing:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/collect_val_labels.html">collect_na_labels</a></span><span class="op">(</span> <span class="va">to_harmonize</span> <span class="op">)</span>
<span class="co">#&gt; [1] "Not asked"</span></code></pre></div>
<p>The set of valid category labels and missing value labels are as follows:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/collect_val_labels.html">collect_val_labels</a></span> <span class="op">(</span><span class="va">to_harmonize</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
                      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span> <span class="st">"trust"</span>, <span class="va">var_name</span><span class="op">)</span> <span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;  [1] "Missing"                          "Not at all"                      </span>
<span class="co">#&gt;  [3] "Just a little"                    "Somewhat"                        </span>
<span class="co">#&gt;  [5] "A lot"                            "Don't know/Haven't heard enough" </span>
<span class="co">#&gt;  [7] "Refused"                          "Don’t know/ Haven't heard enough"</span>
<span class="co">#&gt;  [9] "Don't know/ Haven't heard enough" "Not Asked in this Country"       </span>
<span class="co">#&gt; [11] "Not Asked in Country"             "Don’t know/Haven’t heard enough" </span>
<span class="co">#&gt; [13] "Not asked in the country"</span></code></pre></div>
<p>We create a harmonization function from the <code><a href="../reference/harmonize_values.html">harmonize_values()</a></code> prototype function. In fact, this is just a re-setting the default values of the original function. It makes future reference in pipelines easier, or it can be used for a question block only, in this case to variables with <code>starts_with("trust")</code>.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonize_ab_trust</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">label_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>
    from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"^not"</span>, <span class="st">"^just"</span>, <span class="st">"^somewhat"</span>,
             <span class="st">"^a"</span>, <span class="st">"^don"</span>, <span class="st">"^ref"</span>, <span class="st">"^miss"</span>, <span class="st">"^not"</span>, <span class="st">"^inap"</span><span class="op">)</span>, 
    to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"not_at_all"</span>, <span class="st">"little"</span>, <span class="st">"somewhat"</span>, 
           <span class="st">"a_lot"</span>, <span class="st">"do_not_know"</span>, <span class="st">"declined"</span>, <span class="st">"inap"</span>, <span class="st">"inap"</span>, 
           <span class="st">"inap"</span><span class="op">)</span>, 
    numeric_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>, <span class="fl">99997</span>, <span class="fl">99998</span>, <span class="fl">99999</span>,<span class="fl">99999</span>, <span class="fl">99999</span><span class="op">)</span>
  <span class="op">)</span>
  
  <span class="fu"><a href="../reference/harmonize_values.html">harmonize_values</a></span><span class="op">(</span>
    <span class="va">x</span>, 
    harmonize_labels <span class="op">=</span> <span class="va">label_list</span>, 
    na_values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"do_not_know"</span><span class="op">=</span><span class="fl">99997</span>,
                  <span class="st">"declined"</span><span class="op">=</span><span class="fl">99998</span>,
                  <span class="st">"inap"</span><span class="op">=</span><span class="fl">99999</span><span class="op">)</span>
  <span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We apply this function to the trust variables. The <code>harmonize_surveys()</code> function binds all variables that are present in all surveys.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_ab_waves</span> <span class="op">&lt;-</span> <span class="fu">harmonize_surveys</span> <span class="op">(</span> 
  survey_list <span class="op">=</span> <span class="va">merged_ab</span>, 
  .f <span class="op">=</span> <span class="va">harmonize_ab_trust</span> <span class="op">)</span> </code></pre></div>
<p>Let’s look at the attributes of <code>harmonized_ab_waves</code>.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h_ab_structure</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attributes.html" class="external-link">attributes</a></span><span class="op">(</span><span class="va">harmonized_ab_waves</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">h_ab_structure</span><span class="op">$</span><span class="va">row.names</span> <span class="op">&lt;-</span> <span class="cn">NULL</span> <span class="co"># We have over 100K row names</span>
<span class="va">h_ab_structure</span>
<span class="co">#&gt; $names</span>
<span class="co">#&gt; [1] "date_of_interview"                                   </span>
<span class="co">#&gt; [2] "unique_id"                                           </span>
<span class="co">#&gt; [3] "country"                                             </span>
<span class="co">#&gt; [4] "within_country_weighting_factor"                     </span>
<span class="co">#&gt; [5] "trust_key_leadership_figure_president_prime_minister"</span>
<span class="co">#&gt; [6] "trust_parliament_national_assembly"                  </span>
<span class="co">#&gt; [7] "trust_president"                                     </span>
<span class="co">#&gt; [8] "trust_traditional_leaders"                           </span>
<span class="co">#&gt; [9] "trust_religious_leaders"                             </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $class</span>
<span class="co">#&gt; [1] "tbl_df"     "tbl"        "data.frame"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $id</span>
<span class="co">#&gt; [1] "Waves: Afrobarometer_R5; Afrobarometer_R6; Afrobarometer_R7"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $filename</span>
<span class="co">#&gt; [1] "Original files: merged-round-5-data-34-countries-2011-2013-last-update-july-2015.sav; merged_r6_data_2016_36countries2.sav; r7_merged_data_34ctry.release.sav"</span></code></pre></div>
<p>Let’s add the year of the interview:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_ab_waves</span> <span class="op">&lt;-</span> <span class="va">harmonized_ab_waves</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span>
    <span class="va">date_of_interview</span><span class="op">)</span>,<span class="fl">1</span>,<span class="fl">4</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>To keep our example manageable, we subset the datasets to include only five countries.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_ab_waves</span> <span class="op">&lt;-</span> <span class="va">harmonized_ab_waves</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">country</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Niger"</span>, <span class="st">"Nigeria"</span>, <span class="st">"Algeria"</span>, 
                          <span class="st">"South Africa"</span>, <span class="st">"Madagascar"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="analyzing-the-harmonized-data">Analyzing the harmonized data<a class="anchor" aria-label="anchor" href="#analyzing-the-harmonized-data"></a>
</h2>
<p>The harmonized data can be exported and analyzed in another statistical program. The labelled survey data is stored in <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> vectors, which is a complex class that retains metadata for reproducibility. Most statistical R packages do not know it. The data should be presented either as numeric data with <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code> or as categorical with <code><a href="../reference/as_factor.html">as_factor()</a></code>. (See more why you should not fall back on the more generic <code><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor()</a></code> or <code><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric()</a></code> methods in <a href="https://retroharmonize.dataobservatory.eu/articles/labelled_spss_survey.html" class="external-link">The labelled_spss_survey class vignette.</a>)</p>
<p>Please note that the numeric form of these trust variables is not directly comparable with the numeric averages of the Eurobarometer trust variables, because the middle of the range is at 1.5 and not 0.5.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_ab_waves</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_at</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/vars.html" class="external-link">vars</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trust"</span><span class="op">)</span><span class="op">)</span>, 
              <span class="op">~</span><span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">*</span><span class="va">within_country_weighting_factor</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="st">"within_country_weighting_factor"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span> <span class="op">(</span> <span class="va">country</span>, <span class="va">year</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise_all.html" class="external-link">summarize_if</a></span> <span class="op">(</span> <span class="va">is.numeric</span>, <span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span> <span class="op">)</span> 
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 17 × 7</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   country [5]</span></span>
<span class="co">#&gt;    country       year trust_key_leadership_… trust_parliament_n… trust_president</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Algeria       <span style="text-decoration: underline;">2</span>013                   2.59                1.70          <span style="color: #BB0000;">NaN</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Algeria       <span style="text-decoration: underline;">2</span>015                 <span style="color: #BB0000;">NaN</span>                   1.82            2.00</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Madagascar    <span style="text-decoration: underline;">2</span>013                   1.96              <span style="color: #BB0000;">NaN</span>             <span style="color: #BB0000;">NaN</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Madagascar    <span style="text-decoration: underline;">2</span>014                 <span style="color: #BB0000;">NaN</span>                   1.75            1.95</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Madagascar    <span style="text-decoration: underline;">2</span>015                 <span style="color: #BB0000;">NaN</span>                   1.94            2.15</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Madagascar    <span style="text-decoration: underline;">2</span>018                 <span style="color: #BB0000;">NaN</span>                   1.71            1.83</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Niger         <span style="text-decoration: underline;">2</span>013                   2.59                2.52          <span style="color: #BB0000;">NaN</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Niger         <span style="text-decoration: underline;">2</span>015                 <span style="color: #BB0000;">NaN</span>                   2.43            2.64</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Niger         <span style="text-decoration: underline;">2</span>018                 <span style="color: #BB0000;">NaN</span>                   2.31            2.42</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Nigeria       <span style="text-decoration: underline;">2</span>012                   1.59                1.43          <span style="color: #BB0000;">NaN</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Nigeria       <span style="text-decoration: underline;">2</span>013                   1.59                1.84          <span style="color: #BB0000;">NaN</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Nigeria       <span style="text-decoration: underline;">2</span>014                 <span style="color: #BB0000;">NaN</span>                   1.45            1.64</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Nigeria       <span style="text-decoration: underline;">2</span>015                 <span style="color: #BB0000;">NaN</span>                   1.15            1.30</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Nigeria       <span style="text-decoration: underline;">2</span>017                 <span style="color: #BB0000;">NaN</span>                   1.57            2.06</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">15</span> South Africa  <span style="text-decoration: underline;">2</span>011                   2.04                1.84          <span style="color: #BB0000;">NaN</span>   </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">16</span> South Africa  <span style="text-decoration: underline;">2</span>015                 <span style="color: #BB0000;">NaN</span>                   1.82            1.87</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">17</span> South Africa  <span style="text-decoration: underline;">2</span>018                 <span style="color: #BB0000;">NaN</span>                   1.70            1.86</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 2 more variables: trust_traditional_leaders &lt;dbl&gt;,</span></span>
<span class="co">#&gt; <span style="color: #949494;">#   trust_religious_leaders &lt;dbl&gt;</span></span></code></pre></div>
<p>And the factor representation, without weighting:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span>  <span class="co">## tidyr::pivot_longer()</span>
<span class="va">harmonized_ab_waves</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="st">"within_country_weighting_factor"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate_all.html" class="external-link">mutate_if</a></span> <span class="op">(</span> <span class="va">is.labelled_spss_survey</span>, <span class="va">as_factor</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"trust"</span><span class="op">)</span>, 
                        names_to  <span class="op">=</span> <span class="st">"institution"</span>, 
                        values_to <span class="op">=</span> <span class="st">"category"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> institution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"^trust_"</span>, <span class="st">""</span>, <span class="va">institution</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span> <span class="op">(</span> <span class="va">country</span>, <span class="va">year</span>, <span class="va">institution</span>, <span class="va">category</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span> <span class="op">(</span> n <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span> <span class="op">)</span> 
<span class="co">#&gt; `summarise()` has grouped output by 'country', 'year', 'institution'. You can override using the `.groups` argument.</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 311 × 5</span></span>
<span class="co">#&gt; <span style="color: #949494;"># Groups:   country, year, institution [85]</span></span>
<span class="co">#&gt;    country  year institution                                    category       n</span>
<span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Algeria  <span style="text-decoration: underline;">2</span>013 key_leadership_figure_president_prime_minister little        75</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Algeria  <span style="text-decoration: underline;">2</span>013 key_leadership_figure_president_prime_minister somewhat     341</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Algeria  <span style="text-decoration: underline;">2</span>013 key_leadership_figure_president_prime_minister a_lot        759</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Algeria  <span style="text-decoration: underline;">2</span>013 key_leadership_figure_president_prime_minister do_not_kn…    13</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Algeria  <span style="text-decoration: underline;">2</span>013 key_leadership_figure_president_prime_minister inap          16</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Algeria  <span style="text-decoration: underline;">2</span>013 parliament_national_assembly                   little       317</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Algeria  <span style="text-decoration: underline;">2</span>013 parliament_national_assembly                   somewhat     419</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Algeria  <span style="text-decoration: underline;">2</span>013 parliament_national_assembly                   a_lot         95</span>
<span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Algeria  <span style="text-decoration: underline;">2</span>013 parliament_national_assembly                   do_not_kn…   131</span>
<span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Algeria  <span style="text-decoration: underline;">2</span>013 parliament_national_assembly                   inap         242</span>
<span class="co">#&gt; <span style="color: #949494;"># … with 301 more rows</span></span></code></pre></div>
<p>We subsetted the datasets to meet the vignette size limitations. If you are following our code without reducing the number of countries, you get the following results:</p>
<p><img src="ab_plot1.png" width="95%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.0.</p>
</div>

    </footer>
</div>

  

    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
