<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="retroharmonize">
<title>The labelled_spss_survey class • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="The labelled_spss_survey class">
<meta property="og:description" content="retroharmonize">
<meta property="og:image" content="https://ropengov.github.io/retroharmonize/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rOpenGov">
<meta name="twitter:site" content="@rOpenGov">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/retroharmonize.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="labelled_spss_survey_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>The labelled_spss_survey class</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/HEAD/vignettes/labelled_spss_survey.Rmd" class="external-link"><code>vignettes/labelled_spss_survey.Rmd</code></a></small>
      <div class="d-none name"><code>labelled_spss_survey.Rmd</code></div>
    </div>

    
    
<p>Large international survey programs that provide data access to their data, such as the aforementioned Eurobarometer, Afrobarometer and Arab Barometer, or the European Values Survey, or Lationbarometro usually give access to the data in SPSS files. In some cases, Stata files are available, too. Our examples always start with SPSS files.</p>
<p>In R, the <a href="https://haven.tidyverse.org/" class="external-link">haven</a> package provides functions to import and export data to and from IBM’s proprietary SPSS files. We had to realize that while <a href="https://haven.tidyverse.org/reference/read_spss.html" class="external-link">haven::read_spss</a> works perfectly with importing the data and metadata of a single survey, it is not always suitable for multiple survey files, for two important reasons. SPSS files contain the survey data in a coded form, with the coding (labelling) metadata optionally included to each variable.</p>
<ol style="list-style-type: decimal">
<li><p>Variables imported with inconsistent labelling cannot always be concatenated. For example, unlabelled age variables are imported to an R numeric vector, whilst when the age 18 is labelled <em>18 years</em> or <em>18 éves</em>, it is imported to a labelled class.</p></li>
<li><p>The SPSS variables do not handle various missing cases in a complete and unambiguous form. In an age variable, <em>998</em> and <em>999</em> may be labelled as <em>not asked</em> and <em>declined to answer</em>, or simply the numerical range between 120-999 may be marked as a range of numeric values representing missing cases.</p></li>
</ol>
<p>One practical problem in the Eurobarometer surveys, which targets the population of at least 15 years old Europeans is that in some standard questions, such as the age of finishing full-time education, 10 represents a special missing value, whilst in other surveys it may be a perfectly valid numerical answer. The real coding problem is that SPSS users can freely chose to use explicit labelling of missing cases, using a numerical range for missing cases, or not providing any missing case metadata at all.</p>
<p>Our importing functions rely on two new S3 classes. A single survey is imported into a <code><a href="../reference/survey.html">survey()</a></code> class, which inherits all the properties of a modern data frame, i.e., it is a <code>tibble</code> or <code>tbl_df</code> from <a href="https://tibble.tidyverse.org/" class="external-link">tibble</a> in the tidyverse, but it includes as much metadata from the original SPSS file as possible. These metadata attributes are handled in a way that they can facilitate proper documentation and a reproducible workflow. Furthermore, it converts labelled variables into the <em>retroharmonize_labelled_spss</em> class inherited from <a href="https://haven.tidyverse.org/reference/labelled_spss.html" class="external-link">haven::labelled_spss</a> with more consistent handling of missing value ranges and labels. See <code><a href="../reference/labelled_spss_survey.html">?labelled_spss_survey</a></code>.</p>
<p>Working with our new <em>retroharmonize_labelled_spss class</em> can be very cumbersome, particularly with simple harmonization tasks. In the case of harmonizing a single question from two surveys, this may not be practical, and a simple crosswalk table can help with spotting and correcting inconsistent codes.</p>
<p>Our survey objects or retroharmonize_labelled_spss vectors can be converted to base R classes with the <code><a href="../reference/labelled_spss_survey.html">as_numeric()</a></code>, <code>as_factor(</code>) or <code><a href="../reference/labelled_spss_survey.html">as_character()</a></code> methods. When computing a numerical average, the special age value of 10 is converted to <code>NA_real</code>_ as a numeric. In other statistical applications, missing and special values are best represented as categories—this calls for the factor representation. The character representation is often more useful for visualizing the data then the factor representation.</p>
<div class="section level2">
<h2 id="create-a-labelled_spss_survey-vector">Create A labelled_spss_survey Vector<a class="anchor" aria-label="anchor" href="#create-a-labelled_spss_survey-vector"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span></code></pre></div>
<p>Use the <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> helper function to create vectors of class <em>retroharmonize_labelled_spss_survey</em>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sl1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/labelled_spss_survey.html">labelled_spss_survey</a></span> <span class="op">(</span>
  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">8</span>,<span class="fl">8</span>,<span class="fl">8</span><span class="op">)</span>, 
  labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yes"</span> <span class="op">=</span><span class="fl">1</span>,
             <span class="st">"no"</span> <span class="op">=</span> <span class="fl">0</span>,
             <span class="st">"declined"</span> <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,
  label <span class="op">=</span> <span class="st">"Do you agree?"</span>,
  na_values <span class="op">=</span> <span class="fl">8</span>, 
  id <span class="op">=</span> <span class="st">"survey1"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 1 0 8 8 8</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;      yes       no declined </span>
<span class="co">#&gt;        1        0        8 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "Do you agree?"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"survey1_name")</span>
<span class="co">#&gt; [1] "c(1, 1, 0, 8, 8, 8)"</span>
<span class="co">#&gt; attr(,"survey1_values")</span>
<span class="co">#&gt; 0 1 8 </span>
<span class="co">#&gt; 0 1 8 </span>
<span class="co">#&gt; attr(,"survey1_label")</span>
<span class="co">#&gt; [1] "Do you agree?"</span>
<span class="co">#&gt; attr(,"survey1_labels")</span>
<span class="co">#&gt;      yes       no declined </span>
<span class="co">#&gt;        1        0        8 </span>
<span class="co">#&gt; attr(,"survey1_na_values")</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey1"</span></code></pre></div>
<p>You can check the type:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/labelled_spss_survey.html">is.labelled_spss_survey</a></span> <span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<p>The <code><a href="../reference/labelled_spss_survey.html">labelled_spss_survey()</a></code> class inherits some properties from <code><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">haven::labelled()</a></code>, which can be manipulated by the <code>labelled</code> package (See particularly the vignette <em>Introduction to labelled</em> by Joseph Larmarange.)</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">haven</span><span class="fu">::</span><span class="fu"><a href="https://haven.tidyverse.org/reference/labelled.html" class="external-link">is.labelled</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] TRUE</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="http://larmarange.github.io/labelled/reference/val_labels.html" class="external-link">val_labels</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt;      yes       no declined </span>
<span class="co">#&gt;        1        0        8</span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">labelled</span><span class="fu">::</span><span class="fu"><a href="http://larmarange.github.io/labelled/reference/na_values.html" class="external-link">na_values</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] 8</span></code></pre></div>
<p>It can also be subsetted:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sl1</span><span class="op">[</span><span class="fl">3</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>
<span class="co">#&gt; [1] 0 8</span>
<span class="co">#&gt; attr(,"labels")</span>
<span class="co">#&gt;      yes       no declined </span>
<span class="co">#&gt;        1        0        8 </span>
<span class="co">#&gt; attr(,"label")</span>
<span class="co">#&gt; [1] "Do you agree?"</span>
<span class="co">#&gt; attr(,"na_values")</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; attr(,"class")</span>
<span class="co">#&gt; [1] "retroharmonize_labelled_spss_survey" "haven_labelled_spss"                </span>
<span class="co">#&gt; [3] "haven_labelled"                     </span>
<span class="co">#&gt; attr(,"survey1_name")</span>
<span class="co">#&gt; [1] "c(1, 1, 0, 8, 8, 8)"</span>
<span class="co">#&gt; attr(,"survey1_values")</span>
<span class="co">#&gt; 0 1 8 </span>
<span class="co">#&gt; 0 1 8 </span>
<span class="co">#&gt; attr(,"survey1_label")</span>
<span class="co">#&gt; [1] "Do you agree?"</span>
<span class="co">#&gt; attr(,"survey1_labels")</span>
<span class="co">#&gt;      yes       no declined </span>
<span class="co">#&gt;        1        0        8 </span>
<span class="co">#&gt; attr(,"survey1_na_values")</span>
<span class="co">#&gt; [1] 8</span>
<span class="co">#&gt; attr(,"id")</span>
<span class="co">#&gt; [1] "survey1"</span></code></pre></div>
<p>When used within the modernized version of <em>data.frame</em>, <code><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble::tibble()</a></code>, the summary of the variable content prints in an informative way.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span> <span class="op">(</span>v1 <span class="op">=</span> <span class="va">sl1</span><span class="op">)</span>
<span class="co">## Use tibble instead of data.frame(v1=sl1) ...</span>
<span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 1</span></span>
<span class="co">#&gt;                  v1</span>
<span class="co">#&gt;        <span style="color: #949494; font-style: italic;">&lt;retroh_dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 1<span style="color: #949494;"> [yes]</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 1<span style="color: #949494;"> [yes]</span>          </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 0<span style="color: #949494;"> [no]</span>           </span>
<span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 8<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [declined]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 8<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [declined]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 8<span style="color: #BB0000;"> (NA)</span><span style="color: #949494;"> [declined]</span></span>
<span class="co">## ... which inherits the methods of a data.frame </span>
<span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">v1</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 1</span></span>
<span class="co">#&gt;             v1</span>
<span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;retroh_dbl&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span>      1<span style="color: #949494;"> [yes]</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span>      1<span style="color: #949494;"> [yes]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="coercion-rules-and-type-casting">Coercion rules and type casting<a class="anchor" aria-label="anchor" href="#coercion-rules-and-type-casting"></a>
</h2>
<p>To avoid any confusion with mis-labelled surveys, coercion with double or integer vectors will result in a double or integer vector. The use of <code><a href="https://vctrs.r-lib.org/reference/vec_c.html" class="external-link">vctrs::vec_c</a></code> is generally safer than base R <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#double</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sl1</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span>
<span class="co">#&gt; [1] 1.0000000 1.0000000 0.0000000 8.0000000 8.0000000 8.0000000 0.1428571</span>
<span class="fu">vctrs</span><span class="fu">::</span><span class="fu"><a href="https://vctrs.r-lib.org/reference/vec_c.html" class="external-link">vec_c</a></span><span class="op">(</span><span class="va">sl1</span>, <span class="fl">1</span><span class="op">/</span><span class="fl">7</span><span class="op">)</span>
<span class="co">#&gt; [1] 1.0000000 1.0000000 0.0000000 8.0000000 8.0000000 8.0000000 0.1428571</span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sl1</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 1 0 8 8 8 1 2 3</span></code></pre></div>
<p>Conversion to character works as expected:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] "1" "1" "0" "8" "8" "8"</span></code></pre></div>
<p>The base <code>as.factor</code> converts to integer and uses the integers as levels, because base R factors are integers with a <code>levels</code> attribute.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 1 0 8 8 8</span>
<span class="co">#&gt; Levels: 0 1 8</span></code></pre></div>
<p>Conversion to factor with <code>as_factor</code> converts the value labels to factor levels:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/as_factor.html">as_factor</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] yes      yes      no       declined declined declined</span>
<span class="co">#&gt; Levels: no yes declined</span></code></pre></div>
<p>Similarly, when converting to numeric types, we have to convert the user-defined missing values to <code>NA</code> values used in the R language. For numerical analysis, convert with <code>as_numeric</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 1 0 8 8 8</span>
<span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1]  1  1  0 NA NA NA</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="arithmetics">Arithmetics<a class="anchor" aria-label="anchor" href="#arithmetics"></a>
</h2>
<p>The median value is correctly displayed, because user-defined missing values are removed from the calculation. Only a few arithmetic methods are implemented, such as</p>
<ul>
<li>median()</li>
</ul>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.5</span>
<span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span> <span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.5</span></code></pre></div>
<ul>
<li>quantile()</li>
</ul>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>, <span class="fl">0.9</span><span class="op">)</span>
<span class="co">#&gt; 90% </span>
<span class="co">#&gt;   8</span>
<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span> <span class="op">(</span><span class="va">sl1</span>, <span class="fl">0.9</span><span class="op">)</span>
<span class="co">#&gt; 90% </span>
<span class="co">#&gt;   1</span></code></pre></div>
<ul>
<li>mean()</li>
</ul>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.333333</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.333333</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span> <span class="op">(</span><span class="va">sl1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.6666667</span></code></pre></div>
<ul>
<li>weighted.mean() - always removes NA values.</li>
</ul>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weights1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span> <span class="op">(</span>n <span class="op">=</span> <span class="fl">6</span>, min <span class="op">=</span> <span class="fl">0</span>, max <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>, <span class="va">weights1</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.580239</span>
<span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">sl1</span>, <span class="va">weights1</span><span class="op">)</span>
<span class="co">#&gt; [1] 4.580239</span></code></pre></div>
<ul>
<li>sum()</li>
</ul>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 26</span>
<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span> <span class="op">(</span><span class="va">sl1</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 26</span></code></pre></div>
<p>The result of the conversion to numeric can be used for other mathematical / statistical function.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>
<span class="co">#&gt; [1]  1  1  0 NA NA NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span> <span class="op">(</span> <span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] NA</span>
<span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span> <span class="op">(</span> <span class="fu"><a href="../reference/labelled_spss_survey.html">as_numeric</a></span><span class="op">(</span><span class="va">sl1</span><span class="op">)</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.0.</p>
</div>

    </footer>
</div>

  

    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
