<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="retroharmonize">
<title>Harmonized Cultural Access &amp; Participation Dataset • retroharmonize</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><link href="../deps/_Roboto%20Mono-0.4.0/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Harmonized Cultural Access &amp; Participation Dataset">
<meta property="og:description" content="retroharmonize">
<meta property="og:image" content="https://ropengov.github.io/retroharmonize/logo.png">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@rOpenGov">
<meta name="twitter:site" content="@rOpenGov">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=B612+Mono&amp;display=swap" rel="stylesheet">
<!-- rogtemplate style sheet --><link href="../BS5/rogtemplate.css" rel="stylesheet">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-dark"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">retroharmonize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.4</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-2">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/retroharmonize.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item">
  <a class="nav-link" href="../articles/index.html">Articles</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/rOpenGov/retroharmonize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">
<script src="cap_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Harmonized Cultural Access &amp; Participation Dataset</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/rOpenGov/retroharmonize/blob/HEAD/vignettes/cap.Rmd" class="external-link"><code>vignettes/cap.Rmd</code></a></small>
      <div class="d-none name"><code>cap.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://retroharmonize.dataobservatory.eu/" class="external-link">retroharmonize</a></span><span class="op">)</span>
<span class="va">cap_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'ZA4529_v3-0-1.sav'</span>, <span class="st">'ZA5688_v6-0-0.sav'</span>, <span class="st">'ZA6925_v1-0-0.sav'</span><span class="op">)</span></code></pre></div>
<ul>
<li><p>European Commission (2012). Eurobarometer 67.1 (Feb-Mar 2007). GESIS Data Archive, Cologne. ZA4529 Data file Version 3.0.1, <a href="https://doi.org/10.4232/1.12959" class="external-link">https://doi.org/10.4232/1.10983</a>.</p></li>
<li><p>European Commission, Brussels (2016). Eurobarometer 79.2 (2013). GESIS Data Archive, Cologne. ZA5688 Data file Version 6.0.0, <a href="https://doi.org/10.4232/1.12577" class="external-link">https://doi.org/10.4232/1.12577</a>.</p></li>
<li><p>European Commission and European Parliament, Brussels (2018). Eurobarometer 88.1 (2017). GESIS Data Archive, Cologne. ZA6925 Data file Version 1.0.0, <a href="https://doi.org/10.4232/1.12959" class="external-link">https://doi.org/10.4232/1.12959</a>.</p></li>
</ul>
<p>To replicate this example, you must acquire these files from <a href="https://www.gesis.org/home" class="external-link">GESIS</a> after accepting their terms of use. The <code>retroharmonize</code> project is not affiliated with GESIS.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## This is a dummy path. You should use the path where you saved these files.</span>
<span class="va">gesis_dir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="st">"C:"</span>, <span class="st">"your_data"</span>, <span class="st">"gesis_files"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Create full paths to the three selected files</span>
<span class="va">cap_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">gesis_dir</span>, <span class="va">cap_files</span><span class="op">)</span></code></pre></div>
<div class="section level2">
<h2 id="inventory">Inventory<a class="anchor" aria-label="anchor" href="#inventory"></a>
</h2>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">document_cap_files</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/document_surveys.html">document_surveys</a></span><span class="op">(</span>survey_path <span class="op">=</span> <span class="va">cap_files</span>, .f <span class="op">=</span> <span class="st">"read_spss"</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">document_cap_files</span><span class="op">)</span></code></pre></div>
<p>The files are rather large. We have <code>sum(document_cap_files$nrow)</code> of <code>sum(document_cap_files$ncol)</code> variables. We will only harmonize a few of them.</p>
</div>
<div class="section level2">
<h2 id="importing">Importing<a class="anchor" aria-label="anchor" href="#importing"></a>
</h2>
<p>It is likely that the surveys will fit into your computer’s memory, so you can omit the first step. If you work with many files, and you want to keep working sequentially with survey files, it is a good idea to convert them to R objects.</p>
</div>
<div class="section level2">
<h2 id="concepts-to-harmonize">Concepts to harmonize<a class="anchor" aria-label="anchor" href="#concepts-to-harmonize"></a>
</h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cap_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/metadata_create.html">metadata_create</a></span><span class="op">(</span>survey_files <span class="op">=</span> <span class="va">cap_files</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="harmonization-of-variables">Harmonization of Variables<a class="anchor" aria-label="anchor" href="#harmonization-of-variables"></a>
</h2>
<div class="section level3">
<h3 id="weights">Weights<a class="anchor" aria-label="anchor" href="#weights"></a>
</h3>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weight_variables</span> <span class="op">&lt;-</span> <span class="va">eb_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"isocntry"</span>, <span class="st">"wex"</span>, <span class="st">"wextra"</span>, <span class="st">"v47"</span>, <span class="st">"v7"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weigthing_crosswalk_table</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crosswalk_table_create.html">crosswalk_table_create</a></span><span class="op">(</span><span class="va">weight_variables</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> 
    <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"val_numeric_orig"</span>, <span class="st">"val_numeric_target"</span>, <span class="st">"val_label_orig"</span>, <span class="st">"val_label_target"</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"wex"</span>, <span class="st">"wextra"</span>, <span class="st">"v47"</span><span class="op">)</span> <span class="op">~</span> <span class="st">'wex'</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span>  <span class="op">~</span> <span class="st">'rowid'</span>,  <span class="co"># do not forget to keep the unique row IDs</span>
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"geo"</span><span class="op">)</span>, 
    class_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"geo"</span>, <span class="st">"v47"</span><span class="op">)</span>, <span class="st">"factor"</span>, <span class="st">"numeric"</span><span class="op">)</span>
    <span class="op">)</span></code></pre></div>
<p>The crosswalk table contains the original (source) variable names that must be converted to the target variable names, i.e. <code>v7</code> and <code>isocntry</code> to <code>geo</code> and <code>v47</code>, <code>wextra</code>, and <code>wex</code> to <code>wex</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weigthing_crosswalk_table</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/all_of.html" class="external-link">all_of</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"filename"</span>, <span class="st">"var_name_orig"</span>, <span class="st">"var_name_target"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The Eurobarometer surveys contains separate samples for the former West Germany (<code>DE-W</code>), East Germany (<code>DE-E</code>), Northern Ireland (<code>GB-NIR</code>), and Great Britain, i.e. England, Scotland and Wales (<code>GB-GBN</code>). For the variable <code>geo</code> the appropriate post-stratification weight is the <code>w1</code> variable. For the two German subsamples, it is <code>w_de</code>, and for the two United Kingdom subsamples it is the <code>w_uk</code>. We create two new variables, the <code>country_code</code> and <code>w</code>. When the two UK and the two German samples are joined, the appropriate post-stratification weight is <code>w</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weight_vars</span> <span class="op">&lt;-</span> <span class="va">weight_vars</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> country_code <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">geo</span>, <span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>,
           w <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span> 
             <span class="va">country_code</span> <span class="op">==</span> <span class="st">"DE"</span> <span class="op">~</span>  <span class="va">w_de</span>, 
             <span class="va">country_code</span> <span class="op">==</span> <span class="st">"GB"</span> <span class="op">~</span>  <span class="va">w_uk</span>, 
             <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">w1</span> <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> year_survey <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ZA4529_v3-0-1"</span> <span class="op">~</span> <span class="st">'2007'</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ZA5688_v6-0-0"</span> <span class="op">~</span> <span class="st">'2013'</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="st">"ZA6925_v1-0-0"</span> <span class="op">~</span> <span class="st">'2017'</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> year_survey <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">year_survey</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="demography">Demography<a class="anchor" aria-label="anchor" href="#demography"></a>
</h3>
<p>We will use two important demography variables: the age of the respondent, and the age of school leaving of the respondent. This latter, <code>age_education</code> variable is an important, <em>ex ante</em> harmonized variable in Eurobarometer. Because each European country has different education systems, furthermore, because education systems are not the same across different demographic groups (for example, people schooled before the World War II often went to very different schools), a more precise education level would require a very complicated mapping with education-specific knowledge.</p>
<p>The age_education variable has three special values: 1. the value for declined answers, which should be coded in a numeric representation to the special <code>NA</code> value or R;</p>
<ol start="2" style="list-style-type: decimal">
<li><p>An integer outside the valid range of responses, which means that the person is still tudying. We will recode the still studying answers to 0, and later we will further recode them to the current age of the person. We will also mark this special group as students—in their case, the <code>age_education</code> has a different meaning. A 17 year-old respondent in Europe is likely to study further; a middle aged person who replied with 17 has a low education level according to the current norms. In this case, a student’s response of 17 is not the same as the middle aged person’s;</p></li>
<li><p>And at last, the special value <code>No formal education</code> means that the person did not finish the primary school. Different countries define differently the minimum mandatory age when a person can leave the school system. We code these answers to 14, which is lower than the lowest age in our sample (15). This is also a special group, so we will mark them with a dummy variable, too.</p></li>
</ol>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">demography_crosstable</span> <span class="op">&lt;-</span> <span class="va">eb_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">|</span> 
             <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"age_exact"</span>, <span class="st">"age_education"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/crosswalk_table_create.html">crosswalk_table_create</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
    <span class="co"># Do not leave out the unique row identifiers!</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="st">"rowid"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span> 
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">na_label_orig</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DK"</span>, <span class="st">"Refusal"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"Declined"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span> <span class="op">==</span> <span class="st">"No full-time education"</span> <span class="op">~</span> <span class="fl">14</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span> <span class="op">==</span> <span class="st">"Still studying"</span>         <span class="op">~</span> <span class="fl">0</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">val_numeric_target</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span> <span class="op">==</span> <span class="st">"Declined"</span> <span class="op">~</span> <span class="fl">99999</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> class_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="st">'character'</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"numeric"</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="cultural-access-participation-variables">Cultural Access &amp; Participation Variables<a class="anchor" aria-label="anchor" href="#cultural-access-participation-variables"></a>
</h3>
<p>Our variables of interest are visiting frequencies to concerts and public libraries. In the Eurobarometer CAP surveys, the answers have</p>
<ol style="list-style-type: decimal">
<li>
<code>Never in the last twelve months</code> or <code>None</code> will be coded as 0 visits, and their factor label will be harmonized to <code>never</code>. In this case, the questionnaire reveals that whilst this was an <em>ex ante</em> harmonized question, the answers were not consistently labelled in the three files. We can safely bring these responses to the same value</li>
<li>
<code>1-2 times</code> will be coded to the programatically easier to use <code>1_2_times</code>, and it will get a numeric value of 1.5. Later, we will try to establish a better numeric value, now it is important that all responses labelled as <code>1-2 times</code> should have the same numeric code.</li>
<li>
<code>3-5 times</code> will be coded to the numeric value of 3.5 and 3_5_times.</li>
<li>
<code>More than 5 times</code> will be <code>more_than_5</code> and have the numeric value of 6.</li>
<li>The special case of <code>DK</code> will be coded as <code>declined</code> (to anwer) and the <em>Inap…</em> lables to <code>inap</code>. These are special codes in Eurobarometer meaning that the item is inappropriate, i.e. due to some filtering, this particular question was not asked from the respondant. While respondents who consciously decline an answer usually form a rather homogenous category of their own, the ianppropriate answers are truly missing answers. Their numeric representation will be both <code>NA</code> (f.e. they should be omitted from a numeric average.)</li>
</ol>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">search_term_labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rowid|cultural_activities_public_library|cultural_activities_museums_galleries|cultural_activities_concert|cultural_activities_freq_concert|   
cultural_activities_freq_public_library|cultural_activities_freq_library_or_archive|cultural_activities_freq_museum_gallery"</span><span class="op">)</span>

<span class="va">cap_vars_crosstable</span> <span class="op">&lt;-</span> <span class="va">eb_metadata</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">|</span> 
             <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="va">search_term_labels</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="../reference/crosswalk_table_create.html">crosswalk_table_create</a></span> <span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_orig</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="st">"rowid"</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"concert"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span> <span class="op">~</span> <span class="st">"visit_concert"</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"library"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span> <span class="op">~</span> <span class="st">"visit_library"</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"museum"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span><span class="op">)</span>  <span class="op">~</span> <span class="st">"visit_museum"</span>, 
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_label_orig</span> 
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">na_label_orig</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"DK"</span>, <span class="st">"Refusal"</span><span class="op">)</span> <span class="op">~</span> <span class="st">"declined"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^Inap"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">na_label_orig</span><span class="op">)</span>         <span class="op">~</span> <span class="st">"inap"</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span> <span class="op">==</span> <span class="st">"DK"</span>                <span class="op">~</span> <span class="st">"declined"</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_label_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^more"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span><span class="op">)</span><span class="op">)</span> <span class="op">~</span> <span class="st">"more_than_5"</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"never|^not|none"</span>, <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span><span class="op">)</span><span class="op">)</span>  <span class="op">~</span> <span class="st">"never"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span><span class="op">)</span> <span class="op">==</span> <span class="st">"1-2 times"</span> <span class="op">~</span> <span class="st">"1_2_times"</span>, 
    <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">val_label_orig</span><span class="op">)</span> <span class="op">==</span> <span class="st">"3-5 times"</span> <span class="op">~</span> <span class="st">"3_5_times"</span>,
    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span><span class="op">)</span> <span class="op">~</span>  <span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span>,
    <span class="co"># do not forget the rowid, it should not be labelled</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span> <span class="op">==</span> <span class="st">"rowid"</span> <span class="op">~</span> <span class="cn">NA_character_</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="st">"coding_error"</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> na_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span> <span class="op">==</span> <span class="st">"declined"</span> <span class="op">~</span> <span class="fl">99999</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">na_label_target</span> <span class="op">==</span> <span class="st">"inap"</span>     <span class="op">~</span> <span class="fl">99998</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="cn">NA_real_</span>
  <span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> val_numeric_target <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span> <span class="op">(</span>
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_target</span> <span class="op">==</span> <span class="st">"never"</span>        <span class="op">~</span> <span class="fl">0</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_target</span> <span class="op">==</span> <span class="st">"1_2_times"</span>   <span class="op">~</span> <span class="fl">1.5</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_target</span> <span class="op">==</span> <span class="st">"3_5_times"</span>   <span class="op">~</span> <span class="fl">3.5</span>,
    <span class="va">.data</span><span class="op">$</span><span class="va">val_label_target</span> <span class="op">==</span> <span class="st">"more_than_5"</span> <span class="op">~</span> <span class="fl">6</span>,
    <span class="cn">TRUE</span> <span class="op">~</span> <span class="va">.data</span><span class="op">$</span><span class="va">na_numeric_target</span>
  <span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We create two version of the crosswalk table. One will rename the vist_ variables to fct_visit, and give them a factor representation.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cap_vars_crosstable_fct</span> <span class="op">&lt;-</span> <span class="va">cap_vars_crosstable</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> var_name_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
           test <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grepl</a></span><span class="op">(</span><span class="st">"^visit"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span><span class="op">)</span>, 
           yes  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span><span class="st">"visit"</span>, <span class="st">"fct_visit"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span><span class="op">)</span>, 
           no   <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span><span class="op">)</span>, 
           class_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
             test  <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span> <span class="op">==</span> <span class="st">'rowid'</span>, 
             yes <span class="op">=</span> <span class="st">"character"</span>, <span class="co"># the rowid remains a character</span>
             no  <span class="op">=</span> <span class="st">"factor"</span> <span class="op">)</span>
           <span class="op">)</span>

<span class="va">cap_vars_fct</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crosswalk_surveys.html">crosswalk</a></span><span class="op">(</span>
  crosswalk_table <span class="op">=</span> <span class="va">cap_vars_crosstable_fct</span>,  
  survey_list <span class="op">=</span> <span class="va">cap</span><span class="op">)</span></code></pre></div>
<p>The other will give these variable a numeric representation.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cap_vars_crosstable_num</span> <span class="op">&lt;-</span> <span class="va">cap_vars_crosstable</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
   <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span> class_target <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span>
      test  <span class="op">=</span> <span class="va">.data</span><span class="op">$</span><span class="va">var_name_target</span> <span class="op">==</span> <span class="st">'rowid'</span>, 
      yes <span class="op">=</span> <span class="st">"character"</span>,  <span class="co"># the rowid remains a character</span>
      no <span class="op">=</span> <span class="st">"numeric"</span> <span class="op">)</span>
  <span class="op">)</span>

<span class="va">cap_vars_num</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/crosswalk_surveys.html">crosswalk</a></span><span class="op">(</span>
  crosswalk_table <span class="op">=</span> <span class="va">cap_vars_crosstable_num</span>,  
  survey_list <span class="op">=</span> <span class="va">cap</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="join-the-harmonized-cap-dataset">Join the harmonized CAP dataset<a class="anchor" aria-label="anchor" href="#join-the-harmonized-cap-dataset"></a>
</h2>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_cap_file</span> <span class="op">&lt;-</span> <span class="va">cap_vars_fct</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span> <span class="op">(</span> <span class="va">cap_vars_num</span>,    by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"rowid"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span> <span class="op">(</span> <span class="va">demography_vars</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"rowid"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span> <span class="op">(</span> <span class="va">weight_vars</span>,     by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"rowid"</span><span class="op">)</span> <span class="op">)</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="unit-testing-and-corrections">Unit testing and corrections<a class="anchor" aria-label="anchor" href="#unit-testing-and-corrections"></a>
</h2>
<div class="section level3">
<h3 id="weights-1">Weights<a class="anchor" aria-label="anchor" href="#weights-1"></a>
</h3>
<p>The average post-stratification weight must be 1 for <code>w1</code>, and for <code>w_de</code> and <code>w_uk</code> whenever they are not zero values. The <code>wex</code> variable has no naturally defined mean value.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">weight_vars</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">id</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"w"</span><span class="op">)</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span><span class="op">==</span><span class="fl">0</span>, <span class="cn">NA</span>, <span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">'w'</span><span class="op">)</span>, <span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level3">
<h3 id="missing-labels">Missing labels<a class="anchor" aria-label="anchor" href="#missing-labels"></a>
</h3>
<p>All concert visits labelled as <code>declined</code> and <code>inap</code> must be coded to a numeric <code>NA</code> value. Furthermore, there must not be other <code>NA</code> values than cases in the <code>ZA6925_v1-0-0</code> survey, where this question was not asked. For consistency, these observations should be also coded as <code>inap</code> in the factor representation.</p>
<p>In case of the <code>visit_library</code> variable all missing values should have a factor representation of <code>declined</code> or <code>inap</code>.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_cap_file</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"fct"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"museum"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"library"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit_concert</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct_all.html" class="external-link">distinct_all</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">harmonized_cap_file</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"id"</span>, <span class="st">"fct"</span>, <span class="st">"visit"</span><span class="op">)</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span> <span class="op">(</span> <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"museum"</span><span class="op">)</span>, <span class="op">-</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"concert"</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span> <span class="op">(</span> <span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit_library</span><span class="op">)</span> <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/distinct_all.html" class="external-link">distinct_all</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_cap_file</span> <span class="op">&lt;-</span> <span class="va">harmonized_cap_file</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> fct_visit_museum <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">id</span> <span class="op">==</span> <span class="st">"harmonized_cap_file"</span>, <span class="st">"inap"</span>, <span class="va">.data</span><span class="op">$</span><span class="va">fct_visit_museum</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span> <span class="op">(</span> is_visit_concert <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit_concert</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, 
           is_visit_library <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit_library</span> <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, 
           is_visit_museum  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">.data</span><span class="op">$</span><span class="va">visit_museum</span>  <span class="op">==</span> <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> </code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">harmonized_cap_file</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span> <span class="op">(</span> <span class="va">.data</span><span class="op">$</span><span class="va">id</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span> <span class="op">(</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"visit"</span><span class="op">)</span>,     <span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, 
                     <span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">starts_with</a></span><span class="op">(</span><span class="st">"is_visit"</span><span class="op">)</span>,  <span class="va">mean</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span>, 
                     .groups <span class="op">=</span> <span class="st">"keep"</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="exporting">Exporting<a class="anchor" aria-label="anchor" href="#exporting"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/readRDS.html" class="external-link">saveRDS</a></span><span class="op">(</span><span class="va">harmonized_cap_file</span>,  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"harmonized_cap_dataset.rds"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">harmonized_cap_file</span>,  
          <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"harmonized_cap_file_20211214_doi_10_5281_zenodo_5781672.csv"</span><span class="op">)</span>, 
          row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>You can find this harmonized dataset on Zenodo in the <a href="https://zenodo.org/communities/music_observatory/" class="external-link">Digital Music Observatory</a> and the <a href="https://zenodo.org/communities/ccsi/" class="external-link">Cultural Creative Sectors Industries Data Observatory</a> repositories.</p>
<p><a href="https://doi.org/10.5281/zenodo.5781672" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5781672.svg" alt="DOI"></a></p>
<p>Daniel Antal. (2021). Harmonized Cultural Access &amp; Participation Dataset (Version 20211214) [Data set]. Zenodo. <a href="https://zenodo.org/record/5781672#.Ybkewb3MLIV" class="external-link">https://doi.org/10.5281/zenodo.5781672</a></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://reprex.nl/authors/daniel_antal/" class="external-link">Daniel Antal</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

    </footer>
</div>

  

    <!-- Add ropengov logo -->
  <script src="../BS5/logo.js"></script>
</body>
</html>
